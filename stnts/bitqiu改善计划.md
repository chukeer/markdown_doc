##BitQiu改善计划
**紧急 重要**  

1. 副本异步同步  
   支持副本的异步同步，由业务线设定最小副本数和最终副本数，在当次写入时，只写入最小副本数即返回成功，剩余的副本由系统异步写入，最终达到副本数完整

1. 网络异常处理机制  
   调度按 集群、读写 分为 全网调度，同机房调度、同集群调度 等机制的组合，当网络出现异常时，选择比较合适的调度机制，优先保证数据的读写，当网络恢复正常时，再将数据调度到全网
  
1. 统计并存储丢失的文件副本信息数据，避免例行任务进行副本同步时扫描全部元数据
 

**非紧急 重要**

1. 完善数据收集  
    从目前收集到的数据（性能，错误），有些还没上报，可以从日志中找问题，比如提高性能，减少失败率等
      
1. 告警机制建立  
    BitQiu服务异步将端对端的数据传输耗时写入本地日志，同时提供日志分析脚本，由运维平台进行调用，发现异常由运维平台及时告警
    
1. 解决删除大目录时部分文件元数据未删除干净的问题
    

**一般**

1. 完善运营工具，减少由于运营本身导致的问题

1. BitQiu统计平台升级  
    数据上报到统计中心，经统计中心进行数据分析后，再由BitQiu统计平台进行展示
    
1. 通过web平台调用BitQiu文件级别接口，方便问题跟踪。目前每次跟问题都是用后台python脚本，只有相关人员熟悉使用

**长期计划**

1. 系统性能与鲁棒性提高  
    完善节点故障检测和剔除等机制，增强系统鲁棒性   
    用工具对各个处理流程做性能剖析    
    优化内存使用，减少不必要的分配和拷贝  
    
1. 日志分析  
    研究、实施、总结大型分布式系统中的日志跟踪和问题定位方法


#易乐云改善计划
###c++1. 服务器框架内存使用优化，减少不必要的分配和拷贝（java也需考虑）2. 服务器框架对恶意发包连接的识别和断开功能（java也需考虑）3. 服务器框架log宏扩展，支持按模块记录日志到多个独立文件中4. 排查阻塞式操作，改为异步处理，在不影响业务逻辑的前提下提高对用户的响应速度（java也需考虑）5. 上传、下载逻辑代码性能优化，用valgrind(debug版）和gperftools(release版）分析每个流程的性能（java也需考虑，使用合适的工具）6. 测试工具（脚本），特别是压力测试的开发和完善，考虑测试覆盖率（java也需考虑）7. 服务器稳定性###java1. 防盗链，屏蔽迅雷等下载工具的请求2. WEB下载接口改成post方式，Matrix下载接口方式不变（涉及到客户端更新），测试屏蔽迅雷盗链问题 （java代码已改，还未进行充分测试）3. Netty长连接改连接池及测试4. jvm内存、cpu消耗过高、响应慢的问题排查优化（上周末 mongodb出问题，web日志中 也有相关报错）###运维1，运维监控的持续改进###测试1. 上传和下载接口的性能测试2. 上传操作的安全测试3. 部分接口的稳定性测试4. 后期可能像用户行为模拟这样的场景，我们可能也会跟进###web1. 点击下载出现白屏  【原因分析】下载链接丢给浏览器下载，若链接报错（不返回数据流）当前页面会被替换，即显示报错或出现白屏（matrix内嵌版）。 若使用新开窗口的方式，可能被浏览器拦截。  【解决方案】可以改为post下载，动态创建form表单，将数据post到动态创建的iframe中2. 上传速度波动较大（上一片上传速度明显大于当前片）时，进度条跑的过快，跑到一定程度会卡住，但显示速度还是上一片较大的速度；如果文件大小较小（一片1MB占文件大小40%以上）或较大（文件的1%大小），进度条会在99处卡住      【原因分析】目前假进度条算法 是参考上一片的上传速度，若当前片上传较慢，则导致进度条跑的过快，进度跑到下一片上传完毕的终点，等待真实进度条追上，则会出现卡住的情况。文件较小时，进度条跑太快，跑到99%处等待最后一片上传完；文件较大时，最后1%在网速较慢的情况下会下很久      【解决方案】速度波动控制在10倍以下这种情况不会很明显，已由c++那边做了处理。针对进度条的算法还需优化3. 断点续传未区分用户4. IE 低版本（IE9及以下）ajax请求出现网络连接重置的错误（error_internet_connection_reset ）      【原因分析】暂时没找到确切原因，初步排除代码原因，推测可能是环境因素        【解决方案】需要在线上观察一段时间5. 同一浏览器切换用户不刷新导致的体验问题      【原因分析】云盘是一个单页前端应用（即任何操作都不刷新页面，特殊情况除外 ，如session过期后登录），若用户在同一浏览器双开账号，如使用A用户登录，打开另一个标签退出A用户，使用B用户登录，在A用户的页面不刷新的情况下（实际session已切换到其他用户），会存在数据显示不正确      【解决方案】已针对操作作错误提示处理，已针对url访问异常（即：B用户访问包含A用户信息的链接） 作刷新页面处理，部分根据session作数据显示的部分待处理6. 移动/复制/转存的目录选择弹窗某一级目录下有超过100个文件夹则显示不全      【原因分析】人为控制了获取的文件夹个数      【解决方案】（未做） 目录较多时一次获取100个分页滚动形式拉取###matrix内嵌，云盘桌面版1. 交互流程梳理，排查有问题的交互流程。如果可能，尽量简化交互过程2. 用户体验优化